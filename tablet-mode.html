<!DOCTYPE html>
<html>
<head>
	<style>
		body {
			font-family: Segoe UI;
		}
	</style>
</head>
<body>

	<p>This is a working prototype of a tablet mode detector that only works in Edge.</p>
	<p>Edge doesn't properly update css queries (pointer:coarse) so this will have to be worked into library.</p>
	<p>But not yet and maybe not at all because 1) this is still a lot of code, 2) it's hacky, 3) it's not immune to DOM changes (i tried MutationObserver but without much success so far).</p>

	<script>

	var css = `
		#tablet-mode-detector {
			opacity: 0;
			visibility: hidden;
			touch-action: none;
			pointer-events: none;
			height: 1px;
			width: 1px;
			overflow-x: hidden;
			overflow-y: auto;
		}

		#tablet-mode-detector > div {
			position: relative;
		}

		#tablet-mode-detector > div > div:first-child {
			overflow-x: auto; 
			overflow-y: hidden; 
		}
		#tablet-mode-detector > div > div:first-child::before {
			width: 100px;
			content: '';
			display: block;
		}

		#tablet-mode-detector > div > div:last-child {
			position: absolute;
			top: 0;
			height: 100%;
			width: 50px;
			overflow-x: hidden;
			overflow-y: auto;
		}
		#tablet-mode-detector > div > div:last-child::before {
			content: 'foo';
		}
	`

	var html = '<div><div id="probe1"></div><div id="probe2"></div></div>'

	var body = document.body

	var $style = document.createElement('style')
	$style.type = 'text/css'
	$style.innerHTML = css
	document.head.appendChild($style)
	var $container = document.createElement('div')
	$container.id = 'tablet-mode-detector'
	$container.innerHTML = html
	body.appendChild($container)
	var $probe1 = $container.querySelector('#probe1')
	var $probe2 = $container.querySelector('#probe2')
	$container.addEventListener('scroll', checkMode)
	$probe2.addEventListener('scroll', checkMode)

	var lastThickness
	function checkMode() {
		var newThickness = $probe1.offsetHeight
		if (newThickness === lastThickness) return
		//log('thickness', lastThickness, '->', newThickness)
		var state = newThickness === 0 ? 'TOUCH' : 'MOUSE'
		log(state)
		lastThickness = newThickness
		$container.scrollTop = 100
		$probe2.scrollTop = 100
	}

	function log(state) {
		console.log(state)
		var div = document.createElement('div')
		div.innerHTML = state
		body.appendChild(div)
	}

	checkMode()

	</script>

</body>
</html>